backend = cpp, minver = 201901
CMAKE_MINIMUM_REQUIRED(VERSION 3.0)
PROJECT($MODEL_sampling C CXX)

SET(CMAKE_MODULE_PATH $${CMAKE_MODULE_PATH} "$CPPT_BUILD_LOCATION/share/cmake/")

INCLUDE(CompilerFlags)

SET_COMPILER_FLAGS()

FIND_PACKAGE(CppTransport REQUIRED)

INCLUDE_DIRECTORIES($${CPPTRANSPORT_INCLUDE_DIRS} $${CMAKE_CURRENT_BINARY_DIR} $${COSMOSIS_SRC_DIR}/config/compilers.mk $${COSMOSIS_SRC_DIR})

ADD_CUSTOM_COMMAND(
  OUTPUT $${CMAKE_CURRENT_BINARY_DIR}/$FILENAME_core.h $${CMAKE_CURRENT_BINARY_DIR}/$FILENAME_mpi.h $${CMAKE_CURRENT_BINARY_DIR}/$FILENAME_sampling.cpp
  COMMAND $CPPT_BUILD_LOCATION/bin/CppTransport --verbose --fast $${CMAKE_CURRENT_SOURCE_DIR}/$FILENAME.model
  DEPENDS $FILENAME.model
)

SET(HEADERS $${CMAKE_CURRENT_BINARY_DIR}/$FILENAME_core.h $${CMAKE_CURRENT_BINARY_DIR}/$FILENAME_mpi.h $${CMAKE_CURRENT_BINARY_DIR}/$FILENAME_sampling.cpp )

ADD_CUSTOM_TARGET(Generator DEPENDS $${HEADERS})

ADD_LIBRARY($MODEL_sampling SHARED $${CMAKE_CURRENT_BINARY_DIR}/$FILENAME_sampling.cpp)
ADD_DEPENDENCIES($MODEL_sampling Generator)
TARGET_LINK_LIBRARIES($MODEL_sampling $${CPPTRANSPORT_LIBRARIES} $${COSMOSIS_SRC_DIR}/cosmosis/datablock/libcosmosis.so)
SET_TARGET_PROPERTIES($MODEL_sampling PROPERTIES
  CXX_STANDARD 14
  CXX_STANDARD_REQUIRED YES
  CXX_EXTENSIONS NO
  LINKER_LANGUAGE CXX
  )
TARGET_COMPILE_OPTIONS($MODEL_sampling PRIVATE -O3 -Wno-ignored-attributes -Wno-deprecated-declarations)
